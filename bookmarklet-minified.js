(function(){'use strict';function getTextByLabel(t){const e=document.querySelectorAll('.MuiTypography-body2');for(let l of e){if(l.textContent.includes(t)){const a=l.closest('.MuiBox-root');if(a){const n=a.querySelector('.MuiTypography-body1');if(n)return n.textContent.trim()}}}return ''}function cleanPhone(p){if(!p)return '';const d=p.replace(/\D/g,'');return d.slice(-10)}function getReceivedDate(){const t=document.querySelectorAll('.MuiTimelineItem-root');for(let i of t){const x=i.textContent;if(x.includes('New lead:')){const d=i.querySelector('.MuiTypography-caption');if(d)return parseDateString(d.textContent.trim())}}return null}function parseDateString(s){try{const m=s.match(/(\w+)\s+(\d+),\s+(\d+)\s+(\d+):(\d+)\s+(am|pm)/i);if(!m)return null;const mo={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12};const mn=mo[m[1]];const d=parseInt(m[2]);const y=parseInt(m[3]);let h=parseInt(m[4]);const mi=parseInt(m[5]);const ap=m[6].toLowerCase();if(ap==='pm'&&h!==12)h+=12;if(ap==='am'&&h===12)h=0;return{year:y,month:mn,day:d,hour:h,minute:mi}}catch(e){return null}}function extractSourceData(){return{firstName:getTextByLabel('First name'),lastName:getTextByLabel('Last name'),email:getTextByLabel('Email address'),primaryPhone:cleanPhone(getTextByLabel('Primary phone number')),preferredPhone:cleanPhone(getTextByLabel('Numéro du contact principal')),verbatim:getTextByLabel('Pouvez-vous décrire le problème'),receivedDate:getReceivedDate()}}let modal,isDragging=false,isCollapsed=false,offsetX=0,offsetY=0;function createModal(data){const ex=document.getElementById('doms-form-modal');if(ex)ex.remove();modal=document.createElement('div');modal.id='doms-form-modal';modal.innerHTML=`<div id="modal-header" style="cursor:move;background:#4285f4;color:white;padding:12px;border-radius:8px 8px 0 0;display:flex;justify-content:space-between;align-items:center;"><strong>DOMS → Google Form</strong><div><button id="toggle-collapse" style="background:none;border:none;color:white;cursor:pointer;font-size:18px;margin-right:8px;">−</button><button id="close-modal" style="background:none;border:none;color:white;cursor:pointer;font-size:18px;">×</button></div></div><div id="modal-content" style="padding:16px;max-height:500px;overflow-y:auto;"><div style="margin-bottom:12px;padding:8px;background:#f0f0f0;border-radius:4px;font-size:12px;"><strong>Extracted Data:</strong><br>Name: ${data.firstName} ${data.lastName}<br>Email: ${data.email}<br>Phone: ${data.primaryPhone}<br>${data.preferredPhone?'Preferred: '+data.preferredPhone+'<br>':''}Date: ${data.receivedDate?formatDate(data.receivedDate):'N/A'}</div><label style="display:block;margin-bottom:8px;"><strong>LOB *</strong><br><label><input type="radio" name="lob" value="Wireless" required> Wireless</label><label style="margin-left:12px;"><input type="radio" name="lob" value="Wireline"> Wireline</label></label><label style="display:block;margin-bottom:8px;"><strong>Brand *</strong><br><select id="brand" required style="width:100%;padding:6px;"><option value="">Choose...</option><option>TELUS</option><option>Commercial Security</option><option>Custom Home</option><option>Koodo</option><option>Mascon By TELUS</option><option>PC Mobile</option><option>Public Mobile</option><option>SHS Residential</option><option>SMB Security</option><option>Subscription</option></select></label><label style="display:block;margin-bottom:8px;"><strong>Customer Type *</strong><br><label><input type="radio" name="custType" value="Business" required> Business</label><label style="margin-left:12px;"><input type="radio" name="custType" value="Consumer"> Consumer</label><label style="margin-left:12px;"><input type="radio" name="custType" value="EPP"> EPP</label></label><label style="display:block;margin-bottom:8px;"><strong>Product/Service *</strong><br><select id="product" required style="width:100%;padding:6px;"><option value="">Choose...</option><option>Apple TV</option><option>Copper in Compass</option><option>Copper in CSR</option><option>Corp</option><option>Discovery+</option><option>EPP</option><option>MMB</option><option>Offnet</option><option>Postpaid</option><option>Prepaid</option><option>Pure Fibre in CSR</option><option>SmartEnergy</option><option>SmartHub</option><option>Telus Online Security (TOS)</option><option>Xbox Game Pass Ultimate (XGPU)</option></select></label><label style="display:block;margin-bottom:8px;"><strong>Customer Language *</strong><br><label><input type="radio" name="lang" value="EN" required> EN</label><label style="margin-left:12px;"><input type="radio" name="lang" value="FR"> FR</label></label><label style="display:block;margin-bottom:16px;"><strong>BAN/CID * (1-9 characters)</strong><br><input type="text" id="bancid" required maxlength="9" style="width:100%;padding:6px;"></label><button id="generate-btn" disabled style="width:100%;padding:10px;background:#ccc;color:#666;border:none;border-radius:4px;cursor:not-allowed;font-weight:bold;">Generate Form URL</button></div>`;Object.assign(modal.style,{position:'fixed',top:'50%',left:'50%',transform:'translate(-50%, -50%)',width:'400px',background:'white',borderRadius:'8px',boxShadow:'0 4px 20px rgba(0,0,0,0.3)',zIndex:'999999',fontFamily:'Arial, sans-serif',fontSize:'14px'});document.body.appendChild(modal);setupModalEvents(data)}function formatDate(d){return`${d.month}/${d.day}/${d.year} ${d.hour}:${String(d.minute).padStart(2,'0')}`}function setupModalEvents(data){const hdr=modal.querySelector('#modal-header');const cls=modal.querySelector('#close-modal');const tog=modal.querySelector('#toggle-collapse');const cnt=modal.querySelector('#modal-content');const gen=modal.querySelector('#generate-btn');cls.onclick=()=>modal.remove();tog.onclick=()=>{isCollapsed=!isCollapsed;cnt.style.display=isCollapsed?'none':'block';tog.textContent=isCollapsed?'+':'−'};hdr.onmousedown=(e)=>{if(e.target===cls||e.target===tog)return;isDragging=true;const r=modal.getBoundingClientRect();offsetX=e.clientX-r.left;offsetY=e.clientY-r.top;modal.style.transform='none'};document.onmousemove=(e)=>{if(!isDragging)return;modal.style.left=(e.clientX-offsetX)+'px';modal.style.top=(e.clientY-offsetY)+'px'};document.onmouseup=()=>{isDragging=false};function validateForm(){const lob=modal.querySelector('input[name="lob"]:checked');const brand=modal.querySelector('#brand').value;const custType=modal.querySelector('input[name="custType"]:checked');const product=modal.querySelector('#product').value;const lang=modal.querySelector('input[name="lang"]:checked');const bancid=modal.querySelector('#bancid').value.trim();const isValid=lob&&brand&&custType&&product&&lang&&bancid.length>=1&&bancid.length<=9;gen.disabled=!isValid;if(isValid){gen.style.background='#4285f4';gen.style.color='white';gen.style.cursor='pointer'}else{gen.style.background='#ccc';gen.style.color='#666';gen.style.cursor='not-allowed'}}modal.querySelectorAll('input, select').forEach(el=>{el.addEventListener('change',validateForm);el.addEventListener('input',validateForm)});gen.onclick=()=>{if(!gen.disabled)generateFormURL(data)}}function generateFormURL(data){const lob=modal.querySelector('input[name="lob"]:checked').value;const brand=modal.querySelector('#brand').value;const custType=modal.querySelector('input[name="custType"]:checked').value;const product=modal.querySelector('#product').value;const lang=modal.querySelector('input[name="lang"]:checked').value;const bancid=modal.querySelector('#bancid').value.trim();const fullName=`${data.firstName} ${data.lastName}`.trim();const baseURL='https://docs.google.com/forms/d/e/1FAIpQLSfJ0AQaptO3wIaa09kJhHGULvApaiAdQRnTJzCq7CzwmP3SKw/viewform';const params=new URLSearchParams();if(data.receivedDate){params.append('entry.1882987299_year',data.receivedDate.year);params.append('entry.1882987299_month',data.receivedDate.month);params.append('entry.1882987299_day',data.receivedDate.day);params.append('entry.1882987299_hour',data.receivedDate.hour);params.append('entry.1882987299_minute',data.receivedDate.minute)}params.append('entry.506082014',lob);params.append('entry.104012616',brand);params.append('entry.1228494129',custType);params.append('entry.1098890156',product);params.append('entry.500460836',lang);params.append('entry.615216667',bancid);if(fullName)params.append('entry.1133516513',fullName);if(data.primaryPhone)params.append('entry.504696174',data.primaryPhone);if(data.preferredPhone)params.append('entry.1161771354',data.preferredPhone);if(data.verbatim)params.append('entry.961402602',data.verbatim);const finalURL=`${baseURL}?${params.toString()}`;window.open(finalURL,'_blank');setTimeout(()=>modal.remove(),500)}const sourceData=extractSourceData();createModal(sourceData)})();
